{"ts":1368201997353,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"class PostsController < ApplicationController\n  before_filter :require_login, except: [:index, :show, :admin]\n  layout 'admin', except: [:index, :show]\n\n  def index\n    @posts = Post.published.newest.page(params[:page]).per(10)\n\n    respond_to do |format|\n      format.html\n      format.xml { render xml: @posts }\n      format.rss { render layout: false }\n    end\n  end\n\n  def show\n    @single_post = true\n    @post = Post.find_by_slug(params[:id]) || not_found\n\n    not_found if @post.draft and !logged_in?\n\n    @next = Post.next(@post).last\n    @previous = Post.previous(@post).first\n\n    respond_to do |format|\n      if @post.present?\n        format.html\n        format.xml { render xml: @post }\n      else\n        format.any { render status: 404  }\n      end\n    end\n  end\n\n  def admin\n    if logged_in?\n      @no_header = true\n      @post = Post.new\n      @published = Post.where(draft:false).order('published_at desc')\n      @drafts = Post.where(draft:true).order('updated_at desc')\n    else\n      render 'sessions/new'\n    end\n  end\n\n  def new\n    @post = Post.new(title: params[:title] || '')\n    @post_path = '/'\n\n    respond_to do |format|\n      format.html\n    end\n  end\n\n  def edit\n    @post = Post.find(params[:id])\n    @post_path = post_path(@post.id)\n  end\n\n  def create\n    @post = Post.new(params[:post])\n\n    respond_to do |format|\n      if @post.save\n        format.html { redirect_to \"/edit/#{@post.id}\", notice: \"Post created successfully\" }\n        format.xml { render xml: @post, status: :created, location: @post }\n        format.text { render text: @post.to_json }\n      else\n        format.html { render action: 'new' }\n        format.xml { render xml: @post.errors, status: :unprocessable_entity}\n        format.text { head :bad_request }\n      end\n    end\n  end\n\n  def update\n    @post = Post.find(params[:id])\n    logger.info @post\n\n    respond_to do |format|\n      if @post.update_attributes(params[:post])\n        format.html { redirect_to \"/edit/#{@post.id}\", notice: \"Post updated successfully\" }\n        format.xml { head :ok }\n        format.text { render text: @post.to_json }\n      else\n        format.html { render action: 'edit' }\n        format.xml { render xml: @post.errors, status: :unprocessable_entity}\n        format.text { head :bad_request }\n      end\n    end\n  end\n\n  def destroy\n    @post = Post.find_by_slug(params[:id])\n    @post.destroy\n    flash[:notice] = 'Post has been deleted'\n\n    respond_to do |format|\n      format.html { redirect_to '/admin' }\n      format.xml { head :ok }\n    end\n  end\n\n  private\n\n  def admin?\n    session[:admin] == true\n  end\nend\n"]],"start1":0,"start2":0,"length1":0,"length2":2613}]],"length":2613}
