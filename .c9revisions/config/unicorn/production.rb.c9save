{"ts":1368200421834,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"# RAILS_ROOT/config/unicorn.rb\n# Search for \"# SET ME!\" and replace these with your own settings!.\n\nHOW_DEEP_WE_R_FROM_RAILS_ROOT = \"../..\"\n\n# Set environment to development unless something else is specified\nRAILS_ROOT = File.expand_path(HOW_DEEP_WE_R_FROM_RAILS_ROOT, File.dirname(__FILE__))\nSHARED_PATH = File.expand_path('../shared', RAILS_ROOT)\n\nENV['BUNDLE_GEMFILE'] = File.expand_path(\"#{HOW_DEEP_WE_R_FROM_RAILS_ROOT}/Gemfile\", File.dirname(__FILE__))\nrequire 'bundler/setup'\n\npid_path = \"#{RAILS_ROOT}/tmp/pids/unicorn.pid\"\npid pid_path\n\n# See http://unicorn.bogomips.org/Unicorn/Configurator.html for complete\n# documentation.\nworker_processes 2\n\n# listen on both a Unix domain socket and a TCP port,\n# we use a shorter backlog for quicker failover when busy\nlisten \"#{RAILS_ROOT}/tmp/sockets/nw.sock\", :backlog => 1024\n\n# Preload our app for more speed\npreload_app true\n\nGC.respond_to?(:copy_on_write_friendly=) and\n  GC.copy_on_write_friendly = true\n\n# nuke workers after 30 seconds instead of 60 seconds (the default)\ntimeout 30\n\n# Help ensure your application will always spawn in the symlinked\n# \"current\" directory that Capistrano sets up.\nworking_directory RAILS_ROOT\n\nstderr_path \"#{SHARED_PATH}/log/unicorn.stderr.log\"\nstdout_path \"#{SHARED_PATH}/log/unicorn.stdout.log\"\n\nbefore_fork do |server, worker|\n  # the following is highly recomended for Rails + \"preload_app true\"\n  # as there's no need for the master process to hold a connection\n  if defined?(ActiveRecord::Base)\n    ActiveRecord::Base.connection.disconnect!\n  end\n\n  # Before forking, kill the master process that belongs to the .oldbin PID.\n  # This enables 0 downtime deploys.\n  old_pid = pid_path + \".oldbin\"\n  if File.exists?(old_pid) && server.pid != old_pid\n    begin\n      Process.kill(\"QUIT\", File.read(old_pid).to_i)\n    rescue Errno::ENOENT, Errno::ESRCH\n      # someone else did our job for us\n    end\n  end\nend\n\nafter_fork do |server, worker|\n  # the following is *required* for Rails + \"preload_app true\",\n  if defined?(ActiveRecord::Base)\n    ActiveRecord::Base.establish_connection\n  end\n\n  # if preload_app is true, then you may also want to check and\n  # restart any other shared sockets/descriptors such as Memcached,\n  # and Redis. TokyoCabinet file handles are safe to reuse\n  # between any number of forked children (assuming your kernel\n  # correctly implements pread()/pwrite() system calls)\nend"]],"start1":0,"start2":0,"length1":0,"length2":2400}]],"length":2400}
